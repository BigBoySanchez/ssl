# === Final runtime image ===
FROM pytorch/pytorch:2.6.0-cuda12.4-cudnn9-devel

WORKDIR /workspace

# Install vim for quick fixes
RUN apt update && apt-get install -y vim git

# === Layer Caching Optimization ===
# 1. Copy only requirements first
COPY requirements.txt /workspace/ssl/requirements.txt

# 2. Install dependencies (this layer is now cached unless requirements.txt changes)
RUN pip install --no-cache-dir -r /workspace/ssl/requirements.txt

# 3. Copy the rest of the source code
COPY . /workspace/ssl

# Create symlinks and directories
RUN mkdir -p /workspace/ssl/artifacts /workspace/ssl/data

CMD ["bash"]

